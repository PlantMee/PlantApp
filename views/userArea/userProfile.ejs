<%- include("../partials/header"); -%>
<!--THIS IS THE PROFILE SECTION OF THE USER SO THAT HE COULD MODIFY HIS PROFILE DETAILS -->
<style>body{background:#eee;padding:0px;}.widget-author{margin-bottom:58px}.author-card{position:relative;padding-bottom:48px;background-color:#fff;box-shadow:0 12px 20px 1px rgba(64,64,64,.09)}.author-card .author-card-cover{position:relative;width:100%;height:100px;background-position:center;background-repeat:no-repeat;background-size:cover}.author-card .author-card-cover::after{display:block;position:absolute;top:0;left:0;width:100%;height:100%;content:'';opacity:.5}.author-card .author-card-cover>.btn{position:absolute;top:12px;right:12px;padding:0 10px}.author-card .author-card-profile{display:table;position:relative;margin-top:-22px;padding-right:15px;padding-bottom:16px;padding-left:20px;z-index:5}.author-card .author-card-profile .author-card-avatar,.author-card .author-card-profile .author-card-details{display:table-cell;vertical-align:middle}.author-card .author-card-profile .author-card-avatar{width:85px;border-radius:50%;box-shadow:0 8px 20px 0 rgba(0,0,0,.15);overflow:hidden}.author-card .author-card-profile .author-card-avatar>img{display:block;width:100%;height:83px;}.author-card .author-card-profile .author-card-details{padding-top:20px;padding-left:15px}.author-card .author-card-profile .author-card-name{margin-bottom:2px;font-size:14px;font-weight:bold}.author-card .author-card-profile .author-card-position{display:block;color:#8c8c8c;font-size:12px;font-weight:600}.author-card .author-card-info{margin-bottom:0;padding:0 25px;font-size:13px}.author-card .author-card-social-bar-wrap{position:absolute;bottom:-18px;left:0;width:100%}.author-card .author-card-social-bar-wrap .author-card-social-bar{display:table;margin:auto;background-color:#fff;box-shadow:0 12px 20px 1px rgba(64,64,64,.11)}.btn-style-1.btn-white{background-color:#fff}.list-group-item i{display:inline-block;margin-top:-1px;margin-right:8px;font-size:1.2em;vertical-align:middle}.mr-1,.mx-1{margin-right:.25rem!important}.list-group-item.active:not(.disabled){border-color:#e7e7e7;background:#fff;color:#ac32e4;cursor:default;pointer-events:none}.list-group-flush:last-child .list-group-item:last-child{border-bottom:0}.list-group-flush .list-group-item{border-right:0!important;border-left:0!important}.list-group-flush .list-group-item{border-right:0;border-left:0;border-radius:0}.list-group-item.active{z-index:2;color:#fff;background-color:#007bff;border-color:#007bff}.list-group-item:last-child{margin-bottom:0;border-bottom-right-radius:.25rem;border-bottom-left-radius:.25rem}a.list-group-item,.list-group-item-action{color:#404040;font-weight:600}.list-group-item{padding-top:16px;padding-bottom:16px;-webkit-transition:all .3s;transition:all .3s;border:1px solid #e7e7e7!important;border-radius:0!important;color:#404040;font-size:12px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;text-decoration:none}.list-group-item{position:relative;display:block;padding:.75rem 1.25rem;margin-bottom:-1px;background-color:#fff;border:1px solid rgba(0,0,0,0.125)}.list-group-item.active:not(.disabled)::before{background-color:#ac32e4}.list-group-item::before{display:block;position:absolute;top:0;left:0;width:3px;height:100%;background-color:transparent;content:''}
#imagePreview{
    width:95%;
    margin-left: 2%;
    min-height:90%;
    margin-bottom: 1%;
    border-radius: 4%;
    border: 1px solid #dddddd;
  
    align-items: center;
    justify-content: center;
    font-weight: bold; 
}
.imagePreviewImage{
    border-radius: 4%;
    
    width: 100%;
    object-fit:contain;
}
#imageInput{
    margin-bottom: 2%;  
}
#forgotPassword:hover{
    color:#fcba03;
}

</style>

  <!-- ##### Breadcrumb Area Start ##### -->
      <div class="breadcrumb-area">
            <!-- Top Breadcrumb Area -->
            <div class="top-breadcrumb-area bg-img bg-overlay d-flex align-items-center justify-content-center" style="background-image: url(/resources/UserPages/breadcrumbA.jpg);">
                <h2>BRING IN GOOD WILL</h2>
            </div>
            <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/"><i class="fa fa-home"></i> Home</a></li>                            
                            <li class="breadcrumb-item active" aria-current="page">category</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
      </div>
    <!-- ##### Breadcrumb Area End ##### -->
        <!--TO SHOW ALL THE ALERTS RELATED INFO-->  
        <main role="main" class="container" style="margin-top: 1%;">
               <div class="container">
                 <% if(error && error.length > 0) { %>
                   <div class="alert alert-danger" role="alert"><%=error %></div>
                 <% } %>
                 <% if(success && success.length > 0) { %>
                   <div class="alert alert-success" role="alert"><%= success %></div>
                 <% } %>
                 <% if(info && info.length > 0) { %>
                   <div class="alert alert-info" role="alert"><%= info %></div>
                  <% } %>
                </div> 
        </main>
    </div>
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-4 pb-5">
            <!-- Account Sidebar-->
            <div class="author-card pb-3">
                <div class="author-card-cover" style="background-image: url(https://static.vecteezy.com/system/resources/previews/000/159/103/non_2x/vector-smooth-japanese-maple-plant-with-sun-background-and-fall-maple-leaves.jpg);"></div>
                <div class="author-card-profile">
                 <%if(user.profilePic){ %>
                	<div class="author-card-avatar"><img src="<%= user.profilePic %>">
	                </div>
                 <% }else{ %>
                    <% if(user.gender=="Male"){ %>
	                    <div class="author-card-avatar"><img src="/resources/profileAvatar/maleImage.png">
	                    </div>
	                <% }else{ %>    
		                <div class="author-card-avatar"><img src="/resources/profileAvatar/femaleImage.png">
	                    </div>
	                <% } %>
                 <% } %>
                    <div class="author-card-details">
                        <h5 class="author-card-name text-lg"><%= user.firstName %>&nbsp;<%= user.lastName %></h5><span class="author-card-position"></span>
                    </div>
                </div>
            </div>
            <div class="wizard">
                <div class="list-group list-group-flush" role="tablist">
                    <a class="list-group-item"  data-toggle="list" href="#userOrders" role="tab">
                        <div class="d-flex justify-content-between align-items-center">
                            <div><i class="fe-icon-shopping-bag mr-1 text-muted"></i>
                                <div class="d-inline-block font-weight-medium text-uppercase">Orders List</div>
                            </div><span class="badge badge-secondary"></span>
                        </div>
                    </a>
                    <a class="list-group-item" data-toggle="list" href="#userProfile" role="tab">
                    	<i class="fe-icon-user text-muted"></i>Profile Settings
                    </a>
                    <a class="list-group-item"  data-toggle="list" href="#userAddress" role="tab">
                    	<i class="fe-icon-map-pin text-muted"></i>Addresses
                    </a>
                    <a class="list-group-item" data-toggle="list" href="#userPassword" role="tab">
                        <div class="d-flex justify-content-between align-items-center">
                            <div><i class="fe-icon-heart mr-1 text-muted"></i>
                                <div class="d-inline-block font-weight-medium text-uppercase">Password</div>
                            </div>
                        </div>
                    </a>
                    <a class="list-group-item"  data-toggle="list" href="#userCart" role="tab">
                        <div class="d-flex justify-content-between align-items-center">
                            <div><i class="fe-icon-tag mr-1 text-muted"></i>
                                <div class="d-inline-block font-weight-medium text-uppercase">My Cart</div>
                            </div><span class="badge badge-secondary"><%= user.cart.length %></span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <!-- Profile Settings-->
        <div class="col-lg-8 pb-5">
        <!--===========MULTIPLE SWITCH TABS===========-->	 
            <div class="tab-content">

<!--.........................USER ORDERS SECTION TAB...............................................-->	
				
                    <div class="tab-pane fade" id="userOrders" role="tabpanel">					
    						<% if(user.order){ %>
    							<div style="text-transform: uppercase;" class="alert alert-info" role="alert">
    							  hey you order scetion looks good
    							</div>
    						<% }else{ %>
    							<div style="text-transform: uppercase;" class="alert alert-info" role="alert">
    							  you haven't made any purchase yet
    							</div>   
    						<% } %>
    				</div>


<!--.........................USER PROFILE MAIN SECTION...............................................-->	         	
	        	<div class="tab-pane fade" id="userProfile" role="tabpanel">
                    <div class="card" style="padding:20px;; ">                        
                            <h3 style="text-transform:uppercase;text-align:center;" class="fieldset-title">Personal Info</h3>                                                
                            <hr>
                        <form action="/<%=user._id%>/edit/personal?_method=PUT" method="POST" enctype="multipart/form-data">
                            

                           <!-- USER PICTURE --> 
                            <div  style = "margin:auto;position:static;" class="row form-group">
                                <div class="form-group avatar ">
                                    <div style = "margin:auto;" class="col-md-4">          
                                        <div class="imagePreview" id="imagePreview">
                                            <%if(user.profilePic){ %>                                      
                                              <img src="<%= user.profilePic %>" class="imagePreviewImage" alt="imagePreview">
                                              <span class="imageSpan">Image Preview</span>
                                            <% }else{ %>
                                                <% if(user.gender=="Male"){ %>
                                                    <img src="/resources/profileAvatar/maleImage.png" class="imagePreviewImage" alt="imagePreview">
                                                    <span class="imageSpan">Image Preview</span> 
                                                <% }else{ %>    
                                                    <img src="/resources/profileAvatar/femaleImage.png" class="imagePreviewImage" alt="imagePreview">
                                                    <span class="imageSpan">Image Preview</span> 
                                                <% } %>
                                            <% } %>
                                        </div>
                                        <div class="input-group mb-2">
                                            <div class="custom-file">
                                              <input  type="file" class="custom-file-input" id="inpFile" name="profilePic" accept="image/*">
                                              <label class="custom-file-label" for="inpFile">Choose file</label>
                                            </div>
                                        </div>
                                    </div>                       
                                </div>                                                           
                            </div>
                            <div class="row">    
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="account-fn">First Name</label>
                                        <input class="form-control" name="firstName" type="text" id="account-fn" value="<%= user.firstName %>" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="account-ln">Last Name</label>
                                        <input class="form-control" name="lastName" type="text" id="account-ln" value="<%= user.lastName %>" required>
                                    </div>
                                </div>
                                <!--......................EMAIL ADDRESS.........................-->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="account-email">E-mail Address</label>
                                        <input class="form-control" type="email" id="account-email" value="<%= user.email %>" disabled>
                                    </div>
                                </div>
                                <!--......................PHONE NUMBER..........................-->                    
                                <div class="col-md-6">
                                    <div class="form-group">
                                          <label for="phone">Phone</label>
                                        <input type="text" pattern="[6-9]{1}[0-9]{9}" value="<%= user.phone%>" class="form-control" name="phone"
                                         title="Enter correct phone number">
                                    </div>
                                </div>

                                <div class="col-12">
                                    <hr class="mt-2 mb-3">
                                    <div class="d-flex flex-wrap justify-content-between align-items-center">
                                        <button  type="submit" class="btn btn btn-finish btn-fill btn-warning btn-wd btn-sm">SUBMIT</button>
                                    </div>
                                </div>   
                          </div>    

                        </form>
                    </div>    
                </div>
<!--.........................ADDRESS EDIT SECTION...............................................-->	        
		        <div class="tab-pane fade" id="userAddress" role="tabpanel">
                    <div class="card">
    		        	<div class="card-body">
                            <form class="row" action="/<%=user._id%>/edit/address?_method=PUT" method="POST">                           
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="inputAddress">House</label>
                                        <input type="text" name="address[house]" value="<%=user.address.house%>" class="form-control" id="inputAddress" placeholder="1234 Main St">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="inputAddress2">Street Address </label>
                                        <input type="text" name="address[streetAddress]" value="<%=user.address.streetAddress%>" class="form-control" id="inputAddress2" placeholder="Apartment, studio, or floor">
                                    </div>
                            
                                    <div class="form-group col-md-6">
                                        <label for="inputCity">City</label>
                                        <input type="text" name="address[city]" value="<%=user.address.city%>" placeholder="City" class="form-control" id="inputCity">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="inputState">State</label>
                                        <select id="inputState" name="address[state]" class="form-control">
                                            <% states.states.forEach(function(state){%>
                                                <option value="<%=state %>"><%=state %></option>
                                            <% }) %>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label for="inputZip">Zip</label>
                                        <input required  type="text" class="form-control" value="<%=user.address.pincode%>" name="address[pincode]" id="inputZip">
                                    </div>
                                </div>
                                <hr>
                                <div class="col-12">
                                    <hr class="mt-2 mb-3">
                                    <div class="d-flex flex-wrap justify-content-between align-items-center">
                                        <button class="btn btn-style-1 btn-info" type="submit" data-toast="" data-toast-position="topRight" data-toast-type="success" data-toast-icon="fe-icon-check-circle" data-toast-title="Success!" data-toast-message="Your profile updated successfuly.">New Address</button>
                                    </div>
                                </div>                                 
                            </form>
                        </div>
                    </div>                        
    		    </div>
<!--.........................PASSWORD EDIT PAGE...............................................-->		        
		        <div class="tab-pane fade" id="userPassword" role="tabpanel">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Password</h5>

                            <form action="/<%= user._id %>/edit/password?_method=PUT" method="POST">
                                <div class="form-group">
                                    <label for="inputPasswordCurrent">Current password</label>
                                    <input type="password" name="oldPassword" class="form-control" id="inputPasswordCurrent">
                                    <small><a id="forgotPassword" href="#">Forgot your password?</a></small>
                                </div>
                                <div class="form-group">
                                    <label for="inputPasswordNew">New password</label>
                                    <input type="password" name="firstPass" class="form-control" id="confirmPassword" minlength="8" onkeyup='check();'>
                                </div>
                                <div class="form-group">
                                    <label for="inputPasswordNew2">Verify password</label>
                                    <input type="password" name="password" class="form-control" id="password" minlength="8" onkeyup='check();'>
                                </div>
                                <div>
                                    <span id="message"></span>
                                </div>    
                              
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </form>
                        </div>
                    </div>
                </div>
<!--.........................CART DATA IS AVAILABLE BELOW THIS LINE...............................................-->
                <div class="tab-pane fade" id="userCart" role="tabpanel">
                    <div class="card">

						<style>/* Global settings *//* Global "table" column settings */ .product-image { float: left; width: 20%;} .product-details { float: left; width: 37%;} .product-price { float: left; width: 12%;} .product-quantity { float: left; width: 10%;} .product-removal { float: left; width: 9%;} .product-line-price { float: left; width: 12%; text-align: right;}/* This is used as the traditional .clearfix class */ .group:before, .shopping-cart:before, .column-labels:before, .product:before, .totals-item:before, .group:after, .shopping-cart:after, .column-labels:after, .product:after, .totals-item:after { content: ''; display: table;} .group:after, .shopping-cart:after, .column-labels:after, .product:after, .totals-item:after { clear: both;} .group, .shopping-cart, .column-labels, .product, .totals-item { zoom: 1;}/* Apply clearfix in a few places *//* Apply dollar signs */ .product .product-price:before, .product .product-line-price:before, .totals-value:before { content: 'Rs. ';}/* Body/Header stuff */ body { padding: 0px 30px 30px 20px; font-family: 'HelveticaNeue-Light', 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: 100;} h1 { font-weight: 100;} label { color: #aaa;} .shopping-cart { margin-top: -45px;}/* Column headers */ .column-labels label { padding-bottom: 15px; margin-bottom: 15px; border-bottom: 1px solid #eee;} .column-labels .product-image, .column-labels .product-details, .column-labels .product-removal { text-indent: -9999px;F }/* Product entries */ .product { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee;} .product .product-image { text-align: center;} .product .product-image img { width: 100px;} .product .product-details .product-title { margin-right: 20px; font-family:roboto ,arial;} .product .product-details .product-description { margin: 5px 20px 5px 0; line-height: 1.4em;} .product .product-quantity input { width: 40px;} .product .remove-product { border: 0; padding: 4px 8px; background-color: #c66; color: #fff; font-size: 12px; border-radius: 3px;} .product .remove-product:hover { background-color: #a44;}/* Totals section */ .totals .totals-item { float: right; clear: both; width: 100%; margin-bottom: 10px;} .totals .totals-item label { float: left; clear: both; width: 79%; text-align: right;} .totals .totals-item .totals-value { float: right; width: 21%; text-align: right;} .totals .totals-item-total { font-family: roboto , sans-serif; font-size:20px;} .checkout { float: right; border: 0; margin-top: 20px; padding: 6px 25px; background-color: #6b6; color: #fff; font-size: 25px; border-radius: 3px;} .checkout:hover { background-color: #494;}/* Make adjustments for tablet */ @media screen and (max-width: 650px) { .shopping-cart { margin: 0; padding-top: 20px; border-top: 1px solid #eee;} .column-labels { display: none;} .product-image { float: right; width: auto;} .product-image img { margin: 0 0 10px 10px;} .product-details { float: none; margin-bottom: 10px; width: auto;} .product-price { clear: both; width: 70px;} .product-quantity { width: 100px;} .product-quantity input { margin-left: 20px;} .product-quantity:before { content: 'x';} .product-removal { width: auto;} .product-line-price { float: right; width: 70px;}}/* Make more adjustments for phone */ @media screen and (max-width: 350px) { .product-removal { float: right;} .product-line-price { float: right; clear: left; width: auto; margin-top: 10px;} .product .product-line-price:before { content: 'Item Total: Rs. ';} .totals .totals-item label { width: 60%;} .totals .totals-item .totals-value { width: 40%;}}</style><div class="container" style="margin-top:5%;"><h4>YOUR CART</h4><div class="shopping-cart"> <div class="column-labels"> <label class="product-image">Image</label> <label class="product-details">Product</label> <label class="product-price">Price</label> <label class="product-quantity">Quantity</label> <label class="product-removal">Remove</label> <label class="product-line-price">Total</label> </div><!--.........................CART DATA IS AVAILABLE BELOW THIS LINE...............................................--> <% var total=0 %> <% cart.forEach(function(cartData){%> <div class="product"> <div class="product-image"> <a href="product/<%=cartData.plantId%>"> <img src="<%=cartData.plantImage %>"></a> </div> <div class="product-details"> <div class="product-title"><%=cartData.plantName %></div> <p class="product-description"><%=cartData.plantDesc %></p> </div> <div class="product-price"><%= cartData.price %></div> <div class="product-quantity"> <input type="number" value="<%=cartData.quantity %>" min="1"> </div> <div class="product-removal"> <button  class="remove-product"><a style="display:block;" href="/cart/<%=cartData.plantId%>/remove"> Remove</a>
                          </button> </div> <% var itemTotal = cartData.quantity * cartData.price %> <div class="product-line-price"><%= itemTotal %></div> </div> <% total += itemTotal %> <%})%><!--CART DATA IS AVAILABLE ABOVE THIS LINE--> <div class="totals"> <div class="totals-item"> <label>Subtotal</label> <div class="totals-value" id="cart-subtotal"><%= total %></div> </div> <div class="totals-item"> <label>Tax (0%)</label> <div class="totals-value" id="cart-tax">0</div> </div> <div class="totals-item"> <label>Shipping</label> <div class="totals-value" id="cart-shipping">30</div> </div> <% var grandTotal = total+30 %> <div class="totals-item totals-item-total"> <label>Grand Total</label> <div class="totals-value" id="cart-total"><%= grandTotal %></div> </div> </div> <button class="checkout">Checkout</button></div></div><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript">/* Set rates + misc */var taxRate = 0;var shippingRate = 15.00; var fadeTime = 100;/* Assign actions */$('.product-quantity input').change( function() { updateQuantity(this);});$('.product-removal button').click( function() { removeItem(this);});/* Recalculate cart */function recalculateCart(){ var subtotal = 0; /* Sum up row totals */ $('.product').each(function () { subtotal += parseFloat($(this).children('.product-line-price').text()); }); /* Calculate totals */ var tax = subtotal * taxRate; var shipping = (subtotal > 0 ? shippingRate : 0); var total = subtotal + tax + shipping; /* Update totals display */ $('.totals-value').fadeOut(fadeTime, function() { $('#cart-subtotal').html(subtotal.toFixed(2)); $('#cart-tax').html(tax.toFixed(2)); $('#cart-shipping').html(shipping.toFixed(2)); $('#cart-total').html(total.toFixed(2)); if(total == 0){ $('.checkout').fadeOut(fadeTime); }else{ $('.checkout').fadeIn(fadeTime); } $('.totals-value').fadeIn(fadeTime); });}/* Update quantity */function updateQuantity(quantityInput){ /* Calculate line price */ var productRow = $(quantityInput).parent().parent(); var price = parseFloat(productRow.children('.product-price').text()); var quantity = $(quantityInput).val(); var linePrice = price * quantity; /* Update line price display and recalc cart totals */ productRow.children('.product-line-price').each(function () { $(this).fadeOut(fadeTime, function() { $(this).text(linePrice.toFixed(2)); recalculateCart(); $(this).fadeIn(fadeTime); }); }); }/* Remove item from cart */function removeItem(removeButton){ /* Remove row from DOM and recalc cart total */ var productRow = $(removeButton).parent().parent(); productRow.slideUp(fadeTime, function() { productRow.remove(); RecalculateCart(); });}</script>
                    </div>
                </div>    
	        </div>    
        </div>
    </div>
</div>


<br><br><br>
<script>
//THIS IS TO SHOW PASSWORDS DON'T MATCH IF WRONG
var check = function() {
    var password =document.getElementById('password')
    var confirmPassword= document.getElementById('confirmPassword')
        if(password.value){    
            if (password.value === confirmPassword.value) {
            document.getElementById('message').style.color = 'green';
            document.getElementById('message').innerHTML = 'Passwords Match';
          } else {
            document.getElementById('message').style.color = 'red';
            document.getElementById('message').innerHTML = 'Passwords do not match';
          }
        }
    }
////////////////////////////////////////////////////////////////////////////////////////
//IMAGE DISPLAY SCRIPT
  const inpFile=document.getElementById('inpFile');
  const previewContainer =document.getElementById('imagePreview');
  const previewImage=previewContainer.querySelector(".imagePreviewImage");
  const previewDefaultText=previewContainer.querySelector(".imageSpan");

  inpFile.addEventListener("change",function () {
    const file =this.files[0];
    if(file){
      const reader =new FileReader();
      previewDefaultText.style.display="none";
      previewImage.style.display="block";
      reader.addEventListener("load",function(){
        previewImage.setAttribute("src",this.result);
      });
      reader.readAsDataURL(file);
    }else{
      previewDefaultText.style.display=null;
      previewImage.style.display=null;
    }
  })
</script>
<%- include("../partials/footer"); -%>